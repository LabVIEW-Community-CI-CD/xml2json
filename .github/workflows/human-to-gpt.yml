 jobs:
   intake:
+    permissions:
+      contents: write        # <-- grant GITHUB_TOKEN push rights
     runs-on: ubuntu-latest
     timeout-minutes: 90

     steps:
     - uses: actions/checkout@v4

@@ - Forty lines down in the commit step…
     - name: Commit & push (PR fallback if protected)
       id: commit
       env:
         TS: ${{ steps.write.outputs.TIMESTAMP }}
         GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
       run: |
-        set -euo pipefail
+        set -euo pipefail

         git config user.name  "github-actions[bot]"
         git config user.email "github-actions[bot]@users.noreply.github.com"
         git add .gpt/inbox || true
         git commit -m "🤖 GPT intake: add payload $TS" || echo "Nothing to commit."

-        if git push origin HEAD:main; then
-          echo "✅ Changes pushed to main."
-          echo "BRANCH="   >> "$GITHUB_OUTPUT"
-          echo "PR_URL="   >> "$GITHUB_OUTPUT"
-        else
-          echo "ℹ️  Direct push blocked – opening PR."
-          BRANCH="gpt-input-$TS"
-          git push -u origin HEAD:$BRANCH
-          PR_URL=$(gh pr create \
-                     --base main \
-                     --head "$BRANCH" \
-                     --title "GPT Intake $TS" \
-                     --body  "Automated intake PR for payload $TS")
-          echo "✅ PR opened: $PR_URL"
-          echo "BRANCH=$BRANCH" >> "$GITHUB_OUTPUT"
-          echo "PR_URL=$PR_URL" >> "$GITHUB_OUTPUT"
-        fi
+        # try direct push
+        if git push origin HEAD:main; then
+          echo "✅ Changes pushed to main."
+          echo "BRANCH="   >> "$GITHUB_OUTPUT"
+          echo "PR_URL="   >> "$GITHUB_OUTPUT"
+        else
+          echo "ℹ️  Direct push blocked (403). Attempting PR fallback…"
+          BRANCH="gpt-input-$TS"
+
+          # try branch push
+          if git push -u origin HEAD:$BRANCH; then
+            echo "✅ Branch pushed to $BRANCH."
+            # attempt to open PR
+            if PR_URL=$(gh pr create \
+                         --base main \
+                         --head "$BRANCH" \
+                         --title "GPT Intake $TS" \
+                         --body  "Automated intake PR for payload $TS"); then
+              echo "✅ PR opened: $PR_URL"
+            else
+              echo "❌ PR creation failed; proceeding without a PR." >&2
+              PR_URL=""
+            fi
+          else
+            echo "❌ Branch push to $BRANCH failed (permissions). Skipping PR." >&2
+            PR_URL=""
+          fi
+
+          # always expose outputs, even if empty
+          echo "BRANCH=$BRANCH" >> "$GITHUB_OUTPUT"
+          echo "PR_URL=$PR_URL" >> "$GITHUB_OUTPUT"
+        fi
